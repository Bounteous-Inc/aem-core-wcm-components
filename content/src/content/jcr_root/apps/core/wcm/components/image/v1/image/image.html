<!--/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright 2016 Adobe Systems Incorporated
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/-->
<sly data-sly-use.image="com.adobe.cq.wcm.core.components.models.Image"
     data-sly-use.templates="core/wcm/components/commons/v1/templates.html">
    <a data-sly-unwrap="${!image.link || image.isDecorative}"
        href="${image.link}"
        data-title="${image.title}" data-asset="${image.fileReference}">
    <div data-sly-test="${image.src && image.smartSizes.length >= 2}"
         class="cmp cmp-image cq-dd-image"
         data-cmp-image='{"smartSizes" : [${image.smartSizes}], "smartImages" : [${image.smartImages}], "lazyEnabled": ${image.isLazyLoadingEnabled}}'>
        <sly data-sly-call="${imageTemplate @ image = image, useNoScript = true}"/>
    </div>
    <div data-sly-test="${image.src && image.smartSizes.length < 2}"
         class="cmp cmp-image cq-dd-image"
         data-cmp-image='${image.isLazyLoadingEnabled ? "{\"lazyEnabled\" : true}" : false}'>
        <sly data-sly-call="${imageTemplate @ image = image, useNoScript = image.isLazyLoadingEnabled}"/>
    </div>
    </a>
    <small data-sly-test="${!image.shouldDisplayCaptionPopup && image.title}">${image.title}</small>
    <sly data-sly-test="${!image.src}"
         data-sly-call="${templates.placeholder @ isEmpty = true, classAppend = 'cq-dd-image'}"/>
</sly>
<template data-sly-template.imageTemplate="${@ image='The com.adobe.cq.wcm.core.components.models.Image model', useNoScript}">
    <noscript data-sly-unwrap="${!useNoScript}">
        <img src="${image.src}"
             alt="${image.isDecorative ? '' : image.alt}"
             title="${image.shouldDisplayCaptionPopup ? image.title : ''}"/>
    </noscript>
</template>
