<!--/*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  ~ Copyright 2016 Adobe Systems Incorporated
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~*/-->
<sly data-sly-use.author="Author"
     data-sly-use.clientLib="/libs/granite/sightly/templates/clientlib.html"
     data-sly-test.wcmModeNotDisabledAndTouch="${!wcmmode.isDisabled && author.isTouchAuthoring}"
     data-sly-call="${clientLib.all @ categories='cq.authoring.page'}" />
<sly data-sly-test.wcmModeNotDisabledAndClassic="${!wcmmode.isDisabled && !author.isTouchAuthoring}"
     data-sly-call="${clientLib.all @ categories='cq.wcm.edit'}" />
<script data-sly-test="${wcmModeNotDisabledAndClassic}" type="text/javascript">
    (function() {

        var cfg = ${author.getUndoConfig @ context='unsafe'};
        cfg.pagePath = "${currentPage.path @ context='uri'}";

        if (CQClientLibraryManager.channelCB() != "touch") {
            cfg.enabled = ${wcmmode.isEdit @ context="scriptString"};
            CQ.undo.UndoManager.initialize(cfg);
            CQ.Ext.onReady(function() {
                CQ.undo.UndoManager.detectCachedPage((new Date()).getTime());
            });
        }
    })();

    CQ.WCM.launchSidekick("${currentPage.path @ context='uri'}", {
        propsDialog: "${author.getDialogPath @ context='uri'}",
        locked: ${currentPage.locked @ context="scriptString"}
    });
</script>
<!--/* WCM initialization code end */-->
<sly data-sly-test="${!wcmmode.isDisabled}" data-sly-call="${clientLib.all @ categories='cq.wcm.foundation-main'}" />
<sly data-sly-test="${wcmModeNotDisabledAndTouch}" data-sly-call="${clientLib.all @ categories='cq.shared'}" />